<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <title>Freelancer</title>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous" />
        <link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/styles/style.css" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet" />

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>       
    </h:head>
    <h:body>
        <script>
            $(function () {
                $("[data-toggle=popover]").popover({
                    html: true,
                    content: function () {
                        return $('.popover-body').html();
                    },
                    title: function () {
                        var title = $(this).attr("data-popover-content");
                        return $(title).children(".popover-heading").html();
                    }
                });
            });
        </script>

        <!-- #################################### DIV POPOVER DE NOTIFICAÇÕES #################################### -->

        <div class="popover-body" style="display: none;">
            <h:form>
                <ul>
                    <c:forEach var="notification" items="#{notificationMB.notifications}">
                        <li><p:commandLink action="jobsdetails.xhtml?faces-redirect=true"
                                           actionListener="#{jobMB.edit(notification.job)}"
                                           value="#{notification.description}" /></li>
                    </c:forEach>
                </ul>
            </h:form>
        </div>

        <!-- #################################### DIV POPOVER DE NOTIFICAÇÕES #################################### -->

        <div class="jumbotron jumbotron-fluid img">
            <div class="container" align="center">
                <h1 class="display-4">FreeLancer</h1>
                <p class="lead">Encontre o freelancer para o seu projeto!</p>
                <p align="right"></p>
            </div>
        </div>
        <div class="container">
            <h:panelGroup id="pg-signin-signup" rendered="#{!userMB.isAuthorized()}">
                <div class="row">
                    <div class="col-4">
                        <p:inputText class="form-control" value="#{userMB.user.email}" pt:placeholder="E-mail" />
                    </div>
                    <div class="col-2">
                        <p:password class="form-control" value="#{userMB.user.password}" pt:placeholder="Senha" />
                    </div>

                    <div class="col-1">
                        <h:form>
                            <p:commandButton class="btn-success" value="Entrar" actionListener="#{userMB.login()}" />
                        </h:form>
                    </div>

                    <div class="col-1"></div>

                    <div class="col-4" style="text-align: right;">
                        <h:form>
                            <p style="display: inline;">Não possui uma conta? </p>                         
                            <p:commandButton class="btn-primary" value="Cadastre-se" action="signup.xhtml?faces-redirect=true" /> 
                        </h:form>
                    </div>
                </div>
            </h:panelGroup>

            <h:panelGroup id="pg-user-logged" rendered="#{userMB.isAuthorized()}">
                <h:form>
                    <div class="row">
                        <div class="col-3">
                            <p:outputLabel value="Olá, ${userMB.user.firstName}!" />
                        </div>
                        <div class="col-6"></div>
                        <div class="col-3" align="center">
                            <p:commandButton class="btn btn-block btn-primary" value="Criar novo trabalho" action="jobdetails.xhtml?faces-redirect=true" actionListener="#{jobMB.newJob()}" rendered="#{userMB.isAuthorized()}" />
                        </div>
                    </div>
                </h:form>
            </h:panelGroup>

            <div class="row" style="margin-bottom: -0.5rem;">
                <div class="col">
                    <hr />
                </div>
            </div>

            <div class="row row-spaced" style="margin-bottom: -0.5rem;">
                <div class="col" align="center">                    
                    <h3 style="display: inline;">Lista de trabalhos</h3>
                    <a href="#" data-toggle="popover" title="Notificações" data-placement="bottom" data-content="" style="float: right;">
                        <p:commandButton class="btn-notification" value="#{notificationMB.notifications.size()}" rendered="#{userMB.isAuthorized()}" />
                    </a>                              
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <hr />
                </div>
            </div>

            <div class="row row-spaced">
                <div class="col">
                    <h:form>
                        <p:dataTable id="table-jobs" value="#{jobMB.jobs}" var="job" styleClass="table table-bordered table-striped"
                                     rows="10"
                                     paginator="true"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="10,20,35">
                            <p:column width="50%">
                                <f:facet name="header">Trabalho</f:facet>
                                <h:commandLink value="#{job.title}" action="jobdetails.xhtml?faces-redirect=true" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">Valor por hora</f:facet>
                                <h:outputText value="#{job.amountPerHour}" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">Contratante</f:facet>
                                <h:outputText value="#{jobMB.job.hirer.firstName} #{jobMB.job.hirer.lastName}" />
                            </p:column>
                            <p:column>
                                <p:commandButton class="btn-primary" value="Candidatar-se" actionListener="#{jobMB.addJobRequest(job)}" rendered="#{userMB.isAuthorized()}" />
                            </p:column>
                        </p:dataTable>
                    </h:form>  
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <hr />
                </div>
            </div>
            <div class="row">
                <div class="col" align="center">
                    <p>Autores: Fabricio M. Somini e Guilherme C. Milak</p>
                </div>
            </div>
        </div>        
    </h:body>
</html>

